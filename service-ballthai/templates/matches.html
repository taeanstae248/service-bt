<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏ó‡∏ä‡πå | BallThai</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="/static/css/matches.css">
</head>

<body>
    {{ template "_nav.html" . }}

    <div class="container">
        <div id="alertContainer"></div>
        <div class="teams-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1 class="teams-title">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏ó‡∏ä‡πå</h1>
                <div style="display: flex; gap: 10px; margin-left: auto;">
                    <button id="addMatchBtn" class="btn-primary" onclick="addMatch()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏°‡∏ó‡∏ä‡πå‡πÉ‡∏´‡∏°‡πà</button>
                    <button id="scrapeMatchesBtn" class="btn-primary" onclick="scrapeMatches()">üîÑ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏°‡∏ó‡∏ä‡πå</button>
                </div>
            </div>
        </div>
        <div class="search-container">
            <input type="date" id="date" class="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà...">
            <button class="btn-primary" onclick="fetchMatches()">üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>
        <div id="loadingSpinner" class="loading-spinner" style="display:none;">
            <div class="spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
        <!-- Modal for adding a new match (moved outside matchesContainer) -->
        <div id="addMatchModal" class="modal"
            style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); justify-content:center; align-items:center; z-index:1000;">
            <div class="modal-content"
                style="background:#fff; padding:2rem; border-radius:8px; min-width:320px; max-width:400px; margin:auto; position:relative;">
                <h2 style="margin-top:0;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏°‡∏ó‡∏ä‡πå‡πÉ‡∏´‡∏°‡πà</h2>
                <form id="addMatchForm">
                    <div style="margin-bottom:1rem;">
                        <label>‡∏•‡∏µ‡∏Å</label>
                        <select name="league_id" id="league_select" required class="search-input">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏µ‡∏Å --</option>
                        </select>
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</label>
                        <select name="stage_name" id="stage_name_select" required class="search-input">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô --</option>
                            <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÇ‡∏î‡∏¢ JS ‡πÇ‡∏î‡∏¢ value ‡πÄ‡∏õ‡πá‡∏ô stage_id -->
                        </select>
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>‡∏ß‡∏±‡∏ô‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</label>
                        <input type="date" name="start_date" required class="search-input" id="start_date">
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</label>
                        <input type="time" name="start_time" required class="search-input" id="start_time">
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤</label>
                        <select name="home_team_id" id="home_team_select" required class="search-input">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤ --</option>
                        </select>
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô</label>
                        <select name="away_team_id" id="away_team_select" required class="search-input">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô --</option>
                        </select>
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>‡∏™‡∏Å‡∏≠‡∏£‡πå</label>
                        <input type="number" name="home_score" min="0" value="0" style="width:60px;" id="home_score"> - 
                        <input type="number" name="away_score" min="0" value="0" style="width:60px;" id="away_score">
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>Channel (‡∏ó‡∏µ‡∏ß‡∏µ‡∏´‡∏•‡∏±‡∏Å)</label>
                        <select name="channel_id" id="channel_select" class="search-input">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡∏ß‡∏µ --</option>
                        </select>
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>Live Channel</label>
                        <select name="live_channel_id" id="live_channel_select" class="search-input">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏™‡∏î --</option>
                        </select>
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>‡∏™‡∏ô‡∏≤‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</label>
                        <select name="stadium_id" id="stadium_select" class="search-input">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ô‡∏≤‡∏° --</option>
                        </select>
                    </div>
                    <div style="margin-bottom:1rem;">
                        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</label>
                        <select name="match_status" id="match_status_select" class="search-input">                            
                            <option value="ADD">ADD - (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)</option>
                            <option value="SLIP">SLIP - ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô</option>
                            <option value="FINISHED">FINISHED - ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</option>
                            <option value="OFF">OFF - ‡∏õ‡∏¥‡∏î‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                        </select>
                    </div>
                    <div style="display:flex; justify-content:flex-end; gap:8px;">
                        <button type="button" class="btn" onclick="closeAddMatchModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="matchesContainer">
            <table id="matches-table">
                <thead>
                    <tr>
                        <th>‡∏•‡∏µ‡∏Å</th>
                        <th>‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</th>
                        <th class="home-team">‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤</th>
                        <th class="score-center">‡∏™‡∏Å‡∏≠‡∏£‡πå</th>
                        <th>‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏°‡∏ó‡∏ä‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="/static/js/matches.js"></script>

    <script>
    function scrapeMatches() {
        if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏°‡∏ó‡∏ä‡πå‡∏à‡∏≤‡∏Å‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
        document.getElementById('loadingSpinner').style.display = 'block';
        const baseUrl = window.location.origin;
        fetch(baseUrl + '/scraper/matches')
            .then(res => res.text())
            .then(text => {
                alert('‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ' + text);
                if (typeof fetchMatches === 'function') fetchMatches();
            })
            .catch(err => {
                alert('‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message);
            })
            .finally(() => {
                document.getElementById('loadingSpinner').style.display = 'none';
            });
    }
    </script>

</body>

</html>